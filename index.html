<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>P1 - Coffee Sales</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script>
    var margin = {top: 60, right: 100, bottom: 40, left: 80},
        width = 470 - margin.left - margin.right,
        height = 680 - margin.top - margin.bottom;


    var x = d3.scaleBand().rangeRound([0, width]).padding(0.1)
    var y = d3.scaleLinear().range([height, 0]);

    var svg = d3.select("body")
        .append("svg")
        .style("width", width + margin.left + margin.right + "px")
        .style("height", height + margin.top + margin.bottom + "px")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform","translate(" + margin.left + "," + margin.top + ")")
        .attr("class", "svg");

    d3.csv("colleges.csv", function(colleges) {
      colleges.forEach(function(d) {
        d["Average Cost"] = +d["Average Cost"];
        d["Mean Earnings"] = +d["Mean Earnings 8 years After Entry"];
        d["Median Debt on Grad"] = +d["Median Debt on Graduation"];
        d["Average Family Income"] = +d["Average Family Income"];
      });

      var privateVspublicCost = d3.nest()
      .key(function(d) { return d.Control; })
      .rollup(function(v) { return d3.mean(v, function(d) { return d["Average Cost"]; }); }) // tuition?
      .entries(colleges);
      
      console.log(privateVspublicCost);

        x.domain(privateVspublicCost.map(function(d) { return d.key; }));
        y.domain([0, d3.max(privateVspublicCost, function(d) { return d.value; })]);

        var xaxis = svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .attr("class", "x axis")
            .call(d3.axisBottom(x)
                .tickSize(0, 0)
                .tickSizeInner(0)
                .tickPadding(3));

        svg.append("text")
            .attr("y", height + 30)
            .attr("x", width/2)
            .attr("dx", "1em")
            .style("text-anchor", "middle")
            .text("Control")
            .attr("class", "x axis label");

        svg.append("text")
            .attr("y", 0 - 10)
            .attr("x", width/2)
            .attr("dx", "1em")
            .style("text-anchor", "middle")
            .text("Private Vs Public Colleges (USD)")
            .attr("class", "x axis label");

        var yaxis = svg.append("g")
            .attr("class", "y axis")
            .call(d3.axisLeft(y)
                .ticks(5)
                .tickSizeInner(0)
                .tickPadding(6)
                .tickSize(0, 0));

        svg.append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 0 - 70)
            .attr("x", 0 - (height / 2))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .text("Cost per Semester (USD)")
            .attr("class", "y axis label");
          
        svg.selectAll(".rect")
            .data(privateVspublicCost)
            .enter()
            .append("rect")
                .attr("class", "bar")
                .attr("x", function(d) { return x(d.key); })
                .attr("y", function(d) { return y(d.value); })
                .attr("width", x.bandwidth())
                .attr("height", function(d) { return height - y(d.value); });
    })

    var svg2 = d3.select("body")
        .append("svg")
        .style("width", width + margin.left + margin.right + "px")
        .style("height", height + margin.top + margin.bottom + "px")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform","translate(" + margin.left + "," + margin.top + ")")
        .attr("class", "svg");

    d3.csv("coffee_data.csv", function(error, data){
        data = data.map(function(d){ 
            d["sales"] = +d["sales"]; 
            return d;
        });

        var products = d3.nest()
            .key(function(d) { return d.category; })
            .rollup(function(v) { return d3.sum(v, function(d) { return d.sales; }); })
            .entries(data);
        console.log(products);

        x.domain(products.map(function(d) { return d.key; }));
        y.domain([0, d3.max(products, function(d) { return d.value; })]);

        var xaxis = svg2.append("g")
            .attr("transform", "translate(0," + height + ")")
            .attr("class", "x axis")
            .call(d3.axisBottom(x)
                .tickSize(0, 0)
                .tickSizeInner(0)
                .tickPadding(3));

        svg2.append("text")
            .attr("y", height + 30)
            .attr("x", width/2)
            .attr("dx", "1em")
            .style("text-anchor", "middle")
            .text("Product")
            .attr("class", "x axis label");

        svg2.append("text")
            .attr("y", 0 - 10)
            .attr("x", width/2)
            .attr("dx", "1em")
            .style("text-anchor", "middle")
            .text("Coffee Sales by Product (USD)")
            .attr("class", "x axis label");

        var yaxis = svg2.append("g")
            .attr("class", "y axis")
            .call(d3.axisLeft(y)
                .ticks(5)
                .tickSizeInner(0)
                .tickPadding(6)
                .tickSize(0, 0));

        svg2.append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 0 - 70)
            .attr("x", 0 - (height / 2))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .text("Coffee Sales (USD)")
            .attr("class", "y axis label");
          
        svg2.selectAll(".rect")
            .data(products)
            .enter()
            .append("rect")
                .attr("class", "bar")
                .attr("x", function(d) { return x(d.key); })
                .attr("y", function(d) { return y(d.value); })
                .attr("width", x.bandwidth())
                .attr("height", function(d) { return height - y(d.value); });
    })
    </script>
</body>
<script src="./js/main.js"></script>
</html>
